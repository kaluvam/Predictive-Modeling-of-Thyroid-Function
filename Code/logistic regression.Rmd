---
title: "R Notebook"
output: html_notebook
---
```{r}
# Install packages if not installed
install.packages(c("readxl", "nnet", "caret", "dplyr"))
library(readxl)
library(nnet)
library(caret)
library(dplyr)

# 1) Load dataset
df <- read_excel("dataset.xlsx")    

# View column names
colnames(df)


# Make sure the target is a factor
df$TriiodothyronineRange <- as.factor(df$TriiodothyronineRange)

# 3) Train/Test Split (80/20)
set.seed(123)
index <- createDataPartition(df$TriiodothyronineRange, p = 0.8, list = FALSE)

train <- df[index, ]
test  <- df[-index, ]

# 4) Fit multinomial logistic regression model
multinom_model <- multinom(
  TriiodothyronineRange ~ Gender + Age + Waist + Height + BMI +
    Triiodothyronine + Thyroxine + ThyroidStimulatingHormone,
  data = train,
  trace = FALSE
)

# 5) Summary
summary(multinom_model)

# 6) Predictions
pred_class <- predict(multinom_model, newdata = test)

# 7) Confusion Matrix
confusionMatrix(pred_class, test$TriiodothyronineRange)

# 8) Accuracy
accuracy <- mean(pred_class == test$TriiodothyronineRange)
accuracy

```

```{r}
# Install once if needed:
# install.packages("nnet")

library(nnet)
df <- read_excel("dataset.xlsx")
# --- 1. Make sure variables are in correct format ---
df$TriiodothyronineRange <- as.factor(df$TriiodothyronineRange)
df$Gender <- as.factor(df$Gender)



# --- 3. Odds ratios with 95% CI (2.5% and 97.5%) ---
coef_mat <- coef(model)                          # coefficients
se_mat   <- summary(model)$standard.errors      # standard errors

OR      <- exp(coef_mat)                        # odds ratios
CI_low  <- exp(coef_mat - 1.96 * se_mat)        # 2.5% CI
CI_high <- exp(coef_mat + 1.96 * se_mat)        # 97.5% CI

OR_table <- data.frame(
  Class      = rep(rownames(OR), each = ncol(OR)),
  Predictor  = rep(colnames(OR), times = nrow(OR)),
  Odds_Ratio = as.vector(OR),
  "CI_2.5 "    = as.vector(CI_low),
  "CI_97.5 "   = as.vector(CI_high)
)

print("Odds ratios with 95% CI:")
print(OR_table)

# --- 4. Predicted classes and accuracy (on full df) ---
pred_class <- predict(model, newdata = df)

conf_mat <- table(Predicted = pred_class, Actual = df$TriiodothyronineRange)
print("Confusion matrix:")
print(conf_mat)

accuracy <- mean(pred_class == df$TriiodothyronineRange)
print(paste("Accuracy:", round(accuracy, 4)))

# --- 5. Predicted probabilities for each class ---
pred_prob <- predict(model, newdata = df, type = "probs")
print("First few rows of predicted probabilities:")
head(pred_prob)


```

```{r}
library(pROC)

# prob = predicted probabilities from your logistic regression
# test$target = actual labels (0/1)

roc_obj <- roc(test$target, prob)

plot(
  roc_obj,
  col = "blue",
  lwd = 3,
  main = "ROC Curve â€“ Logistic Regression",
  xlab = "False Positive Rate",
  ylab = "True Positive Rate",
  cex.lab = 1.3,
  cex.axis = 1.2,
  cex.main = 1.4,
  mar = c(5, 6, 4, 2)  # <-- EXTRA LEFT MARGIN so Y-label fits
)

# Add diagonal reference line
abline(a = 0, b = 1, lty = 2, col = "gray", lwd = 2)

# Add AUC text
text(
  x = 0.6,
  y = 0.2,
  labels = paste("AUC =", round(auc(roc_obj), 3)),
  cex = 1.4
)

```

